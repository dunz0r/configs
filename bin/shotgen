#!/bin/bash 
########################################
# File: shotgen.sh                     #
########################################
# Constants
if [ $1 == "-f" ] ; then
    tag=$(date '+%Y-%m-%d-%H%M')-$2
    forum=1
else
    tag=$(date '+%Y-%m-%d-%H%M')-$1
    forum=0
fi

FILE=$tag-scrot.png
THUMB=$tag-scrot-thumb.png
LINKFILE=$tag-links.txt
WALLDIR=$HOME/gfx/bg1
WEBPAGE=http://hax0r.se/files/img/screenshots
SERVER=dunz0r@hax0r.se
########################################
# Perform the Screenshot and
# modify the files as necissary.

scrot -cd 5 $tag-scrot.png

cp $FILE $THUMB
mogrify -resize 10% $THUMB
scp $FILE $THUMB $SERVER:/www/docs/hax0r.se/files/img/screenshots
########################################
# Perform error checking and exit
# gracefully.

if [ $? -eq 0 ] ; then
    notify-send -i /usr/share/awesome/icons/awesome48.png "::shotgen::" "Files uploaded to server."
    if [ $forum -eq 1 ] ; then
        SHOTLINK="[url=$WEBPAGE/$FILE][img]$WEBPAGE/$THUMB[/img][/url]"
    else
        SHOTLINK="$WEBPAGE/$FILE"
    fi
    echo "$SHOTLINK" > $LINKFILE
    notify-send -i /usr/share/awesome/icons/awesome48.png "::shotgen::" "Links Created!"
    xclip $LINKFILE
    rm $LINKFILE
    rm $FILE $THUMB
    exit 0
else
    echo "File upload Failed!"
    rm $FILE $THUMB
    exit 1
fi
